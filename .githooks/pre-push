#!/bin/bash

# Check if Prettier is available via npx
if ! npx --no-install prettier --help > /dev/null 2>&1; then
  echo "Prettier is not installed. Please install it to use this hook."
  exit 1
fi

# Stash current changes to avoid modifying working tree
git stash -q --keep-index

# Run Prettier check and capture the exit code
npx prettier --check "**/*.{js,ts,json,css,html,md}"
prettier_status=$?

# Apply stashed changes back
git stash pop -q

# If Prettier found issues (exit code is non-zero), prompt the user
if [ $prettier_status -ne 0 ]; then
  echo "Prettier has detected formatting issues. Would you like to proceed with the push? (y/n)"
  read -r proceed

  if [[ "$proceed" != "y" ]]; then
    echo "Push aborted. Please format your code and try again: npx tidy"
    exit 1
  fi
else
  echo "All files are formatted correctly."
fi

# If the user confirms, allow the push to proceed
exit 0
