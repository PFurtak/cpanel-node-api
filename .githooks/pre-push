#!/bin/bash

# Check if Prettier is available via npx
if ! npx --no-install prettier --help > /dev/null 2>&1; then
  echo "Prettier is not installed. Please install it to use this hook."
  exit 1
fi

# Stash current changes to avoid modifying working tree
git stash -q --keep-index

# Run Prettier check and capture the exit code
npx prettier --check "**/*.{js,ts,json,css,html,md}"
prettier_status=$?

# Apply stashed changes back quietly
git stash pop -q

# If Prettier found issues (exit code is non-zero), prompt the user
if [ $prettier_status -ne 0 ]; then
  echo "Prettier has detected formatting issues."
  echo "Would you like to proceed with the push? (y/n)"
  
  # Read user input and store the result
  read -p "Enter your choice: " proceed

  if [[ "$proceed" != "y" ]]; then
    echo "Push aborted. Please format your code and try again."
    exit 1
  else
    echo "Proceeding with the push despite formatting issues."
  fi
else
  echo "All files are formatted correctly."
fi

# If everything is fine or user allows, continue with the push
exit 0
